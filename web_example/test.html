<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
    body {
         font-family: Arial, Helvetica, sans-serif;
    }
    .btn { margin: 5px 5px 5px 5px; }
    </style>
  <head>
  <body>
    <h2>Example of wrapping CCP4 libraries (and dependencies) to Web Assembly with emscripten</h2>
    <script async type="text/javascript" src="web_example.js"></script>
    <script>
function foo(){

        const selectedFile = document.getElementById('pdb_input').files[0];
        const cifSelectedFile = document.getElementById('cif_input').files[0];
        const mtzSelectedFile = document.getElementById('mtz_input').files[0];
        var r = new FileReader();
        var r_cif = new FileReader();
        var r_mtz = new FileReader();
        r_mtz.onload = function(e) {
            var contents = e.target.result;
            try {
                Module['FS_createDataFile'](".", mtzSelectedFile.name, contents, true, true);
            } catch(e) {
            }

            var result = Module.clipper_example(mtzSelectedFile.name);

        }
        if(mtzSelectedFile) r_mtz.readAsBinaryString(mtzSelectedFile);
        r.onload = function(e) {
            var contents = e.target.result;
            try {
                Module['FS_createDataFile'](".", selectedFile.name, contents, true, true);
            } catch(e) {
            }

            var result = Module.mmdb2_example(selectedFile.name);

            r_cif.onload = function(e2){
                var contents2 = e2.target.result;
                try {
                    Module['FS_createDataFile'](".", cifSelectedFile.name, contents2, true, true);
                } catch(e) {
                }
                var startTime = performance.now();
                var result = Module.initialize_cif_pdb(cifSelectedFile.name,selectedFile.name,0,0.75);
                var endTime = performance.now();
                console.log(`Call to doSomething took ${endTime - startTime} milliseconds`);
            }

            if(cifSelectedFile) r_cif.readAsText(cifSelectedFile);

        }
        if(selectedFile) r.readAsText(selectedFile);
        

    }
    </script>
    <h2>Input</h2>
    <p>All inputs are optional.
    <ul>
    <li>If a coordinate is provided then a simple count of CA is done.
    <li>If a coordinate file and structure factor file are provided then a map is calculated from the 2 and the CA count is done as well.
    <li>If an MTZ file is provided then a map is calculated.
    </ul>
    <div>
    <span>Coordinate file</span>
    <input type="file" id="pdb_input" class="btn"><br />
    <span>Structure factor file</span>
    <input type="file" id="cif_input" class="btn"><br />
    <span>MTZ file</span>
    <input type="file" id="mtz_input" class="btn"><br />
    <input type="button" class="btn" value="Load" onclick="foo()"></input>
    </div>
    <div style="width:96%; left-margin:3%; top-margin:20px;">
    <pre id="output" style="border:1px solid green; height:200px;overflow-x:auto; overflow-y:scroll;"></pre>
    </div>
<script>
var Module={preRun:[],postRun:[],
print:function(){var e=document.getElementById("output");return e&&(e.innerHTML=""),function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments).join(" ")),console.log(t),e&&(e.innerHTML+=t+"\n",e.scrollTop=e.scrollHeight)}}(),
printErr:function(){var e=document.getElementById("output");return e&&(e.innerHTML=""),function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments).join(" ")),console.log(t),e&&(e.innerHTML+=t+"\n",e.scrollTop=e.scrollHeight)}}()
};
        Module['onRuntimeInitialized'] = function(){
            document.getElementById("output").innerHTML = "";
        }
</script>
 
  </body>
</html>

